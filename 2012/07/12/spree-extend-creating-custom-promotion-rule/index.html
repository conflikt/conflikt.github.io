<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>spree extend: creating custom promotion rule | Sandeep Kumar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="railsspreespree extend" />
  
  
  
  
    <meta name="360-site-verification" content="[object Object]" />
  
  <meta name="description" content="I’m working on an E-commerce website for sometime now. We are usingi spree as backbone of the project and customizing where and when its required. Spree is quite good and fully functioning E-commerce">
<meta property="og:type" content="article">
<meta property="og:title" content="Spree Extend: Creating Custom Promotion Rule">
<meta property="og:url" content="http://r3bo0t.github.io/2012/07/12/spree-extend-creating-custom-promotion-rule/index.html">
<meta property="og:site_name" content="Sandeep Kumar">
<meta property="og:description" content="I’m working on an E-commerce website for sometime now. We are usingi spree as backbone of the project and customizing where and when its required. Spree is quite good and fully functioning E-commerce">
<meta property="og:updated_time" content="2016-12-21T08:16:43.557Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spree Extend: Creating Custom Promotion Rule">
<meta name="twitter:description" content="I’m working on an E-commerce website for sometime now. We are usingi spree as backbone of the project and customizing where and when its required. Spree is quite good and fully functioning E-commerce">
  
    <link rel="alternate" href="/atom.xml" title="Sandeep Kumar" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >

</head>

<body>
  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            <a href="/" title="Sandeep Kumar" rel="home">
              Sandeep Kumar</a>
          </h1>
          <div class="site-description">Learn . Experiment . Build . Repeat</div>

            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">Categories</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div style="background:#fff;width: 100%;">

      <div style="max-height:600px; overflow: hidden;">
        <img width="100%" alt="Hike News" src="/css/images/pose.jpg">
      </div>

  </div>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-spree-extend-creating-custom-promotion-rule" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Spree Extend: Creating Custom Promotion Rule
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2012/07/12/spree-extend-creating-custom-promotion-rule/" class="article-date">
	  <time datetime="2012-07-11T18:30:00.000Z" itemprop="datePublished">July 12, 2012</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’m working on an E-commerce website for sometime now. We are usingi <a href="http://spreecommerce.com/" target="_blank" rel="external">spree</a> as backbone of the project and customizing where and when its required. Spree is quite good and fully functioning E-commerce Rails engine which give you base to build a e-commerce website quickly and with lesser efforts.</p>
<p>One of the main features of any e-commerce website is Promotions/Coupons. Spree also has a built in spree promotion module which is ready to use with predefined rules and adjustment calculators. Being an ADMIN I can define any new promotion rules i.e. first order, user specific, products specific etc. Also I can define the actions like ALL or ANY. You can have a look on spree_promo module at <a href="https://github.com/spree/spree/tree/master/promo" target="_blank" rel="external">spree_promo</a> and see how it works.</p>
<p>Spree already provides some 4-5 predefined Promotions Rules on the basis of which every order get cross-checked whether some adjustments has to be done or not. Most of the time these rules/calculators are more than enough in general usage, but sometimes we need few very specific CUSTOM rules to be defined. Here I’m going to explain how easy it is to create new spree promotion rules.</p>
<h4 id="Create-Promotion-Rule"><a href="#Create-Promotion-Rule" class="headerlink" title="Create Promotion Rule"></a>Create Promotion Rule</h4><ol>
<li>create a model file app/models/spree/promotion/rules/my_custom_promotion.rb</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">module Spree</div><div class="line">  class Promotion::Rules::MyCustomPromotion &amp;lt; PromotionRule</div><div class="line">    // required associations or preferences if any</div><div class="line">    // required attribute accessible if you need to protect some attributes from mass assignment</div><div class="line">    // match polices and operators</div><div class="line">    MATCH_POLICIES = %w(any all) // as per your requirement</div><div class="line">    def eligible?(order, options=&#123;&#125;)</div><div class="line">      // This method is the place where every order is being verified whether its eligible for any promotional discount</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<ol>
<li>Add this custom promotion rule to default spree promotion rules list. Write the following code in either <code>application.rb</code> or some initializer</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">initializer <span class="string">"spree.promo.register.promotions.rules"</span> <span class="keyword">do</span> <span class="params">|app|</span></div><div class="line">  app.config.spree.promotions.rules += [Spree::Promotion::Rules::MyCustomPromotion]</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<ol>
<li>Add the translations for name &amp; description for custom rule as spree use the standard view for all with Translation method <code>t(&#39;name&#39;)</code> or <code>t(&#39;description&#39;)</code>. Write the following code in your <code>config/locales/en.yml</code> (or any other locale file if you are having multilingual products).</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attr">en:</span></div><div class="line"><span class="attr">  promotion_rule_types:</span></div><div class="line"><span class="attr">    product_by_tag:</span></div><div class="line"><span class="attr">      name:</span> Products By MyCustomPromotion</div><div class="line"><span class="attr">      description:</span> Add products from MyCustomPromotion</div></pre></td></tr></table></figure>
<ol>
<li>Create the view partial file for the custom promotion rule. Add a file <code>app/admin/promotions/rules/_my_custom_promotion.html.erb</code> or haml or something else depending on the template engine you are using for views. And, restart your application server and you are good to go. Now whenever you are going to edit the Promotion, in the promotions rules list you will see you custom rule also available.</li>
</ol>
<ul>
<li>if you want some custom price adjustments/calculations as well, then you have to create a new calculator. E.g. If I want to define some flat percentage benefit on my custom promotion we have to create <code>app/models/spree/calculator/flat_percentage.rb</code></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">module Spree</div><div class="line">  class Calculator::FlatPercetange &amp;lt; Calculator</div><div class="line">    // preferences if there are any.</div><div class="line">    // attributes accessibles</div><div class="line">    def compute(object)</div><div class="line">      // main method where we have to compute the adjustments we have to made.</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>I hope it helped someone. In case of any query, please feel free to ask here or drop me a mail at <a href="mailto:skr.ymca@gmail.com?subject=Re:Creating custom spree promotion rule" target="_blank" rel="external">Sandeep Kumar</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spree/">spree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spree-extend/">spree extend</a></li></ul>

      
        
      <section id="comments" class="comment">
        <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
        </section>

        <script type="text/javascript">
        var disqus_shortname = 'sandeepkrao';
      (function(){
       var dsq = document.createElement('script');
       dsq.type = 'text/javascript';
       dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       }());
      (function(){
       var dsq = document.createElement('script');
       dsq.type = 'text/javascript';
       dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       }());
      </script>

        

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2012/07/19/spree-extend-updating-eligibility-criteria-for-any-existing-promotion-rule/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Spree Extend: Updating eligibility criteria for any existing promotion rule
        
      </div>
    </a>
  
  
    <a href="/2011/12/12/generating-dashboard-like-layout-for-android-with-titanium/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Generating Dashboard like layout for android with Titanium</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-Promotion-Rule"><span class="toc-number">1.</span> <span class="toc-text">Create Promotion Rule</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 Sandeep Kumar All Rights Reserved.
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    
<script>
  var disqus_shortname = 'sandeepkrao';
  
  var disqus_url = 'http://r3bo0t.github.io/2012/07/12/spree-extend-creating-custom-promotion-rule/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>





  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
  

  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


</body>
</html>
